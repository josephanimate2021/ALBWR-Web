<!doctype html>
<html lang="en" data-bs-theme="auto">
  <head>
    <script src="/js/color-modes.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.122.0">
    
    <title>A Link Between Worlds Randomizer v4 Web UI Â· ALBWR Web</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/checkout/">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/xterm.css"/>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="/js/xterm.js"></script>
    <script src="/js/addon-fit.js"></script>
    <script src="/js/xterm-addon-web-links.js"></script>

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      .b-example-divider {
        width: 100%;
        height: 3rem;
        background-color: rgba(0, 0, 0, .1);
        border: solid rgba(0, 0, 0, .15);
        border-width: 1px 0;
        box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
      }

      .b-example-vr {
        flex-shrink: 0;
        width: 1.5rem;
        height: 100vh;
      }

      .bi {
        vertical-align: -.125em;
        fill: currentColor;
      }

      .nav-scroller {
        position: relative;
        z-index: 2;
        height: 2.75rem;
        overflow-y: hidden;
      }

      .nav-scroller .nav {
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        margin-top: -1px;
        overflow-x: auto;
        text-align: center;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .btn-bd-primary {
        --bd-violet-bg: #712cf9;
        --bd-violet-rgb: 112.520718, 44.062154, 249.437846;

        --bs-btn-font-weight: 600;
        --bs-btn-color: var(--bs-white);
        --bs-btn-bg: var(--bd-violet-bg);
        --bs-btn-border-color: var(--bd-violet-bg);
        --bs-btn-hover-color: var(--bs-white);
        --bs-btn-hover-bg: #6528e0;
        --bs-btn-hover-border-color: #6528e0;
        --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
        --bs-btn-active-color: var(--bs-btn-hover-color);
        --bs-btn-active-bg: #5a23c8;
        --bs-btn-active-border-color: #5a23c8;
      }

      .bd-mode-toggle {
        z-index: 1500;
      }

      .bd-mode-toggle .dropdown-menu .active .bi {
        display: block !important;
      }

      .randoOutput {
        display: none;
      }
      .collapsing {
        height: 0;
        overflow: hidden;
        transition: height .35s ease;

        &.collapse-horizontal {
          width: 0;
          height: auto;
          transition: width .35s ease;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="/css/newRando.css" rel="stylesheet">
  </head>
  <body class="bg-body-tertiary">
    <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
      <symbol id="check2" viewBox="0 0 16 16">
        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
      </symbol>
      <symbol id="circle-half" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
      </symbol>
      <symbol id="moon-stars-fill" viewBox="0 0 16 16">
        <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
      </symbol>
      <symbol id="sun-fill" viewBox="0 0 16 16">
        <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
      </symbol>
    </svg>

    <div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">
      <button class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center"
              id="bd-theme"
              type="button"
              aria-expanded="false"
              data-bs-toggle="dropdown"
              aria-label="Toggle theme (auto)">
        <svg class="bi my-1 theme-icon-active" width="1em" height="1em"><use href="#circle-half"></use></svg>
        <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>
      </button>
      <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="bd-theme-text">
        <li>
          <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
            <svg class="bi me-2 opacity-50" width="1em" height="1em"><use href="#sun-fill"></use></svg>
            Light
            <svg class="bi ms-auto d-none" width="1em" height="1em"><use href="#check2"></use></svg>
          </button>
        </li>
        <li>
          <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
            <svg class="bi me-2 opacity-50" width="1em" height="1em"><use href="#moon-stars-fill"></use></svg>
            Dark
            <svg class="bi ms-auto d-none" width="1em" height="1em"><use href="#check2"></use></svg>
          </button>
        </li>
        <li>
          <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
            <svg class="bi me-2 opacity-50" width="1em" height="1em"><use href="#circle-half"></use></svg>
            Auto
            <svg class="bi ms-auto d-none" width="1em" height="1em"><use href="#check2"></use></svg>
          </button>
        </li>
      </ul>
    </div>
    <div class="container">
      <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
          <span class="fs-4">ALBW Randomizer</span>
        </a>
  
        <ul class="nav nav-pills">
          <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
          <li class="nav-item"><a href="javascript:;" id="modalRandoRepoCloneOpenBtn" data-bs-target="#modalRandoRepoClone" data-bs-toggle="modal" class="nav-link">Randomize Game Using It's Source Code</a></li>
        </ul>
      </header>
    </div>
    <div class="modal" tabindex="-1" id="myPresetsModal">
      <div class="modal-dialog modal-fullscreen" id="myPresetsModalDialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Your Presets</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="myPresets"></div>
          <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
      <div class="modal-dialog" style="display: none;" id="presetModificationPleaseWait">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="presetModificationStatus"></h5>
          </div>
          <center>
            <progress class="modal-body" id="presetModificationProgress"></progress>
          </center>
        </div>
      </div>
    </div>
    <div class="modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" id="presetUploader">
      <form class="modal-dialog modal-xl" action="javascript:;" onsubmit="uploadPreset(this)">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Bring Your Own Preset</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>
              There are 2 methods that you can use to bring in your own preset. You may:
              <ol>
                <li>Upload a preset file with the option to publish it if you want to.</li>
                <li>Publish your preset using it's current settings so that everyone can see and use your preset if they wanted to.</li>
              </ol>
            </p>
            <div title="The preset file that will be uploaded to the server. Don't worry, if you choose not to publish your preset, your file will either get deleted after game randomization or when you leave/reload the page.">
              <label class="form-label" for="presetFile">Preset File (Must be a JSON file)</label>
              <input type="file" id="presetFile" accept=".json" class="form-control"/>
            </div>
            <div title="When checked, a section will appear where you can begin typing in your preset infomation">
              <br>
              <input type="checkbox" onclick="setupPresetPublisher()" class="form-check-input" id="publishPresetCheckmark"/>
              <label class="form-check-label" for="publishPresetCheckmark">Publish Preset</label>
            </div>
            <div id="publishingPresetDiv"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Upload Preset</button>
          </div>
        </div>
      </form>
      <div class="modal-dialog" style="display: none;" id="presetUploadPleaseWait">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="presetUploadStatus"></h5>
          </div>
          <center>
            <progress class="modal-body" id="presetUploadProgress"></progress>
          </center>
        </div>
      </div>
    </div>
    <div class="modal" tabindex="-1" id="modalRandoRepoClone">
      <div class="modal-dialog">
        <form class="modal-content" action="javascript:;" onsubmit="gameRandoSourceCode.beginRepoClone(this)">
          <div class="modal-header">
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link active gameRandoSourceCodeTabBtn" href="javascript:;" data-show="cloneSourceCode">Clone Source Code</a>
              </li>
              <li class="nav-item">
                <a class="nav-link gameRandoSourceCodeTabBtn" data-show="mySourceCodes" href="javascript:;">Your Cloned Source Codes</a>
              </li><!--
              <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
              </li>
              <li class="nav-item">
                <a class="nav-link disabled" aria-disabled="true">Disabled</a>
              </li>-->
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div id="cloneSourceCode" class="tabedDiv">
            <div class="modal-body">
              <p>Please follow the instructions on the form in order to get the source code accordingly.</p>
              <div id="alertBlock4GameRandoViaSourceCode"></div>
              <div id="settings" style="display: none;">
                <label for="branch">Source Code Branch</label>
                <select class="form-control" id="branch" name="branch"></select>
                <div id="forkOnlySettings" style="display: none;">
                  <label for="owner">Source Code Owner</label>
                  <select class="form-control" id="owner" onchange="gameRandoSourceCode.loadSourceCodeInfoFromAuthor(this)"></select>
                </div>
                <div class="form-check text-start my-3">
                  <input class="form-check-input" type="checkbox" id="forkTick" onchange="gameRandoSourceCode.show('forks')">
                  <label class="form-check-label" for="forkTick">
                    Use A Fork
                  </label>
                </div>
                <div class="form-check text-start my-3">
                  <input class="form-check-input" type="checkbox" id="commitTick" onchange="gameRandoSourceCode.show('commitsOnly')">
                  <label class="form-check-label" for="commitTick">
                    Use A Commit Instead of a Branch (Not Recommended)
                  </label>
                </div>
              </div>
              <div class="d-flex justify-content-center" id="settingsLoading">
                <div class="spinner-border m-5" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <hr>
              <center>Source Code Fork Pages</center>
              <hr>
              <div class="btn-group d-flex">
                <button type="button" class="btn btn-success randoPageBtn" id="pageBackward" disabled title="Go Back One Page"><-</button>
                <span id="pageNum">0</span>
                <button type="button" class="btn btn-success randoPageBtn" id="pageForward" disabled title="Go Forward One Page">-></button>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary" id="repoCloneBtn" disabled title="This will use git to clone the source code over to ALBWR Web's uploads folder." data-bs-dismiss="modal">Begin Source Code Clone</button>
            </div>
          </div>
          <div id="mySourceCodes" class="tabedDiv" style="display: none;">test</div>
        </form>
      </div>
    </div>
    <div class="randoOutput" id="terminal"></div>
    <div class="container">
      <main>
        <div class="py-5 text-center" id="logo">
          <img class="d-block mx-auto mb-4" src="https://github.com/user-attachments/assets/a1185a97-2e5f-4bde-901b-23836b2ca64e" alt="The Legend Of Zelda: A Link Between Worlds Randomizer">
          <h2>Randomize Game Using The Latest Version Of ALBWR</h2>
          <p class="lead">
            Below is the form where you can fill out the infomation needed to randomize your game.
            <br>If you want, you may publish your preset with it's current settings shown below by going into <br><code>Setting Presets > Bring Your Own Preset > Publish Preset</code>.
          </p>
        </div>
        <div id="alertBlock" class="hideDuringRandomization"></div>
        <script>
          class GameRandoSourceCode { 
            // Allows a user to randomize albw with the in-dev version of the source code without downloading rust + source code and figuring out the CLI 
            // (unless they want to use the CLI which is coming soon for this specific version)
            constructor(url, p) {
              this.info ||= {};
              this.showWhat ||= {};
              this.loadSourceCodeInfo('', url, p);
            }
            displayAlert(type, text = '') {
              $("#alertBlock4GameRandoViaSourceCode").html(!text ? '' : `<div class="alert alert-${type}" role="alert">${text}</div>`)
            }
            jQueryURL(method, url, body = {}) {
              return new Promise(res => jQuery[method](url, body, res));
            }
            async fetchUrl(url, type, options) {
              const res = await fetch(url, options);
              if (!res.ok) {
                const json = await res.json();
                this.displayAlert('error', json.message.replace("documentation", `<a href="${json.documentation_url}">documentation</a>`));
                return;
              }
              return await res[type]();
            }
            async loadSourceCodeInfo(callback, url, p) {
              const info = this.info[url || this.url] ||= {};
              $("#pageNum").text(0);
              document.getElementById('pageBackward').setAttribute("disabled", "")
              document.getElementById('pageForward').setAttribute("disabled", "")
              this.displayAlert('', '');
              $("#settings").hide();
              if ($("#settingsLoading").hasClass("d-none")) $("#settingsLoading").removeClass("d-none");
              $("#settingsLoading").addClass("d-flex");
              document.getElementById('repoCloneBtn').setAttribute("disabled", "")
              try {
                info.repo ||= await this.fetchUrl(url, 'json') || {};
                info.branches ||= await this.fetchUrl(url + (p || '') + '/branches', 'json') || []
                info.commits ||= await this.fetchUrl(url + (p || '') + '/commits', 'json') || [];
                info.forks ||= await this.fetchUrl(url + '/forks', 'json') || [];
                if (url) {
                  this.originalUrl ||= url;
                  this.url = url;
                }
                if (p) this.p ||= p; 
                const d = this.showWhat.commitsOnly ? info.commits : info.branches;
                let html = '';
                for (let i = 0; i < d.length; i++) {
                  const v = d[i];
                  const val = this.showWhat.commitsOnly ? (() => {
                    const maxLength = 29;
                    const oldCommit = info.commits[maxLength];
                    if (d.length > maxLength) this.displayAlert("warning", `Not all of the commits will not show up as options due to a limit of commits that can show up all at once. Any commits older than ${oldCommit.sha?.slice(0, -33) || oldCommit.short_id} will not show up in the options dropdown menu.`);
                    return v.sha || v.id;
                  })() : v.name;
                  const title = v.message || v.commit?.message || (info.commits.find(i => i.id == v.commit?.id))?.message || (
                    info.commits.find(i => i.sha == v.commit?.sha)
                  )?.commit?.message || `No commit message was provided for this branch.`;
                  const innerText = this.showWhat.commitsOnly ? `Commit ${v.sha?.slice(0, -33) || v.short_id}${i == 0 ? ` (Recent)` : ``}` : val;
                  html += `<option value="${val}"${title ? ` title="${title}"` : ''}${info.repo.default_branch == val ? ' selected=""' : ''}>${innerText}</option>`
                }
                $("#branch").html(html);
                if (typeof callback == "function") callback();
                else {
                  $("#settings").show();
                  document.getElementById("repoCloneBtn").removeAttribute("disabled");
                }
              } catch (e) {
                console.error(e);
                this.displayAlert('danger', e.toString());
              }
              $("#settingsLoading").removeClass("d-flex");
              $("#settingsLoading").addClass("d-none")
            }
            async show(type) {
              this.showWhat[type] = !this.showWhat[type]
              const info = this.info[this.url];
              this.loadSourceCodeInfo(() => {
                if (type == "forks") {
                  let html = '';
                  if (this.showWhat.forks) {
                    for (var i = 0; i < info.forks.length; i++) {
                      const fork = info.forks[i];
                      if (i == 0) this.loadSourceCodeInfo('', this.url.replace(info.repo.full_name || info.repo.id, fork.full_name || fork.id), this.p);
                      html += `<option value="${fork.full_name || fork.id}">${fork.namespace?.name || fork.owner?.login || ''}</option>`
                    }
                    if (info.forks.length > 0) {
                      $("#forkOnlySettings").show();
                      $("#pageNum").text(1);
                      document.getElementById("pageForward").removeAttribute("disabled")
                    }
                  } else {
                    $("#forkOnlySettings").hide();
                    this.loadSourceCodeInfo('', this.originalUrl, this.p);
                  }
                  $("#owner").html(html);
                }
                $("#settings").show();
                document.getElementById("repoCloneBtn").removeAttribute("disabled");
              });
            }
            findInArray(param, val, array) {
              for (const fork of typeof array != "object" || !Array.isArray(array) ? [] : array) {
                if (fork[param] == val) return fork;
              }
            }
            findInJson(param, val, json) {
              for (const fork in typeof json != "object" ? {} : json) {
                if (fork[param] == val) return fork;
              }
            }
            loadSourceCodeInfoFromAuthor(obj) {
              const info = this.info[this.originalUrl];
              this.loadSourceCodeInfo('', this.originalUrl.replace(info.repo.full_name || info.repo.id, obj.value), this.p)
            }
            beginRepoClone(obj) {
              const info = Object.fromEntries(new URLSearchParams($(obj).serialize()));
              const {
                randoGameBtn,
                back2rando,
                zipfiledownload,
                back2randobtnlistenr,
                logo,
                term
              } = initTerminal("Cloning The ALBW Randomizer Source Code...");
              term.write("The git clone command is about to run in a few moments. Please wait.");
              const socket = new WebSocket(`${grabURL4WebSocket()}/cloneRepo`);
              socket.addEventListener("message", e => {
                if (e.data == "success") {
                  randoGameBtn.textContent = "The clone was successful!";
                  term.write(`The source code was cloned successfuly! You will be redirected in a few moments`);
                  setTimeout(() => {
                    window.location.href = `/dev?repoName=${this.info[this.url].repo.name}`
                  }, 4096);
                } else if (e.data == "fail") {
                  randoGameBtn.textContent = "The clone has failed";
                  updateAttribute(document.getElementById('modalRandoRepoCloneOpenBtn'), "data-bs-toggle", "modal");
                  term.write(`The source code failed to clone over to your directory for cloned source codes. Please try the clone again by clicking on the "Randomize Game Using It's Source Code" link on the right of the header.`);
                } else term.write(e.data);
              });
              socket.addEventListener("open", e => socket.send(JSON.stringify(Object.assign({}, this, info))))
            }
          }
          let gameRandoSourceCode = new GameRandoSourceCode(`https://api.github.com/repos/rickfay/z17-randomizer`);
          function setupPresetPublisher(elemId = 'publishingPresetDiv', appendExistingContent = false) {
            gameRandoSourceCode.publishingPreset ||= {};
            gameRandoSourceCode.publishingPreset[elemId] = !gameRandoSourceCode.publishingPreset[elemId];
            if (gameRandoSourceCode.publishingPreset[elemId]) {
              const fallbackContent = `<div class="form-floating" title="A name for your preset. Make sure to title it in a way where it's easy to find.">
                <input type="text" class="form-control" id="presetName" placeholder="My New Preset" name="presetName" required>
                <label for="presetName">Preset Name</label>
              </div>
              <div class="form-floating" title="Any notes about your preset. As of right now, this feature only works in the v0.4 family of the albw randomizer. PRO TIP: Pressing the enter key while typing in your notes will create bulletpoints which can help for if you want to make your notes a list essentially.">
                <textarea class="form-control" id="presetNotes" placeholder="You should play this preset for the best experience ever with the albw randomizer!" name="notes"></textarea>
                <label for="presetNotes">Notes (Optional)</label>
              </div>`;
              if (!appendExistingContent) document.getElementById(elemId).innerHTML = fallbackContent;
              else document.getElementById(elemId).innerHTML = document.getElementById(elemId + 'Content')?.innerHTML || fallbackContent;
            }
            else document.getElementById(elemId).innerHTML = '';
          }
          function setVersion(obj) {
            document.getElementById('randoVer').innerText = obj.id
            for (const eI of document.getElementById('versions').children) eI.classList.remove("active");
            obj.classList.add("active");
            jQuery('input[name="version"]').val($(obj).find(".my-0").text())
          }
          function grabURL4WebSocket() {
            return `${window.location.protocol.startsWith("https") ? 'wss' : 'ws'}://${window.location.host}`;
          }
          for (const elem of document.getElementsByClassName('gameRandoSourceCodeTabBtn')) {
            elem.addEventListener("click", e => {
              if (!e.target.classList.contains("active")) {
                for (const elem of document.getElementsByClassName('gameRandoSourceCodeTabBtn')) elem.classList.remove("active");
                for (const elem of document.getElementsByClassName('tabedDiv')) elem.style.display = 'none';
                document.getElementById(e.target.getAttribute("data-show")).style.display = 'block';
                e.target.classList.add("active");
              }
            })
          }
        </script>
        <div class="row g-5">
          <div class="col-md-5 col-lg-4 order-md-last hideDuringRandomization">
            <button class="d-flex justify-content-between align-items-center mb-3 btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
              <span>Randomizer Version</span>
              <span class="badge bg-primary rounded-pill" id="randoVer">v0.4.0-release</span>
            </button>
            <ul class="dropdown-menu mb-3" id="versions">
              <li id="v0.4.1-beta-2025-03-26" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.1 - Beta Build 2025-03-26</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.1-beta-2025-03-26" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.1-beta-2025-03-25" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.1 - Beta Build 2025-03-25</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.1-beta-2025-03-25" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.0-release" class="dropdown-item d-flex justify-content-between active" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-release" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-success">Stable Release</span>
              </li>
              <li id="v0.4.0-beta-2025-02-06" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2025-02-06</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2025-02-06" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.0-beta-2025-01-16" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2025-01-16</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2025-01-16" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.0-beta-2024-12-02" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2024-12-02</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2024-12-02" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="sgl-2024-09-10" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">SGL Tournament Build - 2024-09-10</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/sgl-2024-09-10" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-info">Special Release For The 2024 SGL Tournament</span>
              </li>
              <li id="v0.4.0-beta-2024-09-05" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2024-09-05</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2024-09-05" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.0-beta-2024-08-26" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2024-08-26</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2024-08-26" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.0-beta-2024-08-15" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2024-08-15</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2024-08-15" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="v0.4.0-beta-2024-08-06" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2024-08-06</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/v0.4.0-beta-2024-08-06" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-warning">Pre Release</span>
              </li>
              <li id="sgl-2024" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - SGL Tournament Build #1</h6>
                  <small class="text-body-secondary">
                    Click
                    <a href="https://github.com/rickfay/z17-randomizer/releases/tag/sgl-2024" target="_blank">here</a>
                    for infomation about this release
                  </small>
                </div>
                <span class="text-info">Special Release For The 2024 SGL Tournament</span>
              </li>
              <li id="v0.4.0-beta-2024-07-21" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - Beta Build 2024-07-21</h6>
                  <small class="text-body-secondary">
                    There is currently no infomation about this release right now.
                  </small>
                </div>
                <span class="text-danger">Development Release</span>
              </li>
              <li id="v0.4.0-wip" class="dropdown-item d-flex justify-content-between" onclick="setVersion(this)">
                <div>
                  <h6 class="my-0">v0.4.0 - SNAPSHOT</h6>
                  <small class="text-body-secondary">
                    There is currently no infomation about this release right now.
                  </small>
                </div>
                <span class="text-danger">Development Release</span>
              </li>
            </ul>
            <script>
              window.addEventListener("load", e => {
                window.addEventListener("beforeunload", function (e) {
                  var confirmationMessage = 'It looks like you have been editing something. If you leave before saving, your changes will be lost.';
                  const stuff = (e || window.event);
                  stuff.preventDefault();
                  stuff.returnValue = confirmationMessage;
                  return confirmationMessage;
                });
                loadSettings();
              })
              let presets;
              function displayAlert(type, text) {
                if (type && text) $("#alertBlock").html(`<div class="alert alert-${type}" role="alert">${text}</div>`);
                else $("#alertBlock").html('');
              }
              function capWord(d) {
                return d.substring(0, 1).toUpperCase() + d.substring(1);
              }
              function selectPreset(obj) {
                if (document.getElementById('presetCustomization').value != "disabled") appendSetting(presets[obj.getAttribute("data-presetNum")]);
                const preset = document.getElementById('preset');
                preset.innerText = $(obj).find("h6").text();
                updateAttribute(preset, "data-presetNum", obj.getAttribute("data-presetNum"));
                for (const child of document.getElementById('presets').children) $(child).removeClass("active");
                $(obj).addClass("active");
              }
              function updateAttribute(elem, attr, val) {
                elem.removeAttribute(attr);
                elem.setAttribute(attr, val);
              }
              function initTerminal(btnLoadText) {
                document.getElementById('terminal').innerHTML = '';
                updateAttribute(document.getElementById('modalRandoRepoCloneOpenBtn'), "data-bs-toggle", "");
                for (const elem of document.getElementsByClassName('hideDuringRandomization')) elem.style.display = 'none';
                for (const elem of document.getElementsByClassName('randoOutput')) elem.style.display = 'block';
                const randoGameBtn = document.getElementById('randoGameBtn');
                const back2rando = document.getElementById('back2randobtn');
                const zipfiledownload = document.getElementById('zipfiledownload');
                const back2randobtnlistenr = evt => {
                  for (
                    const elem of document.getElementsByClassName('hideDuringRandomization')
                  ) elem.style.display = elem.getAttribute("data-isFlex") != undefined ? 'flex' : 'block';
                  for (const elem of document.getElementsByClassName('randoOutput')) elem.style.display = 'none';
                  term.clear()
                  logo.style.display = 'block';
                  randoGameBtn.removeAttribute("disabled");
                  randoGameBtn.textContent = "Randomize Game";
                  evt.target.classList.remove('d-block')
                  evt.target.classList.add('d-none')
                  zipfiledownload.classList.remove('d-flex');
                  zipfiledownload.removeAttribute("href");
                  zipfiledownload.classList.add('d-none');
                }
                back2rando.removeEventListener("click", back2randobtnlistenr);
                const logo = document.getElementById('logo');
                logo.style.display = 'none';
                randoGameBtn.setAttribute("disabled", "");
                randoGameBtn.textContent = btnLoadText;
                const term = new Terminal({
                  convertEol: true,
                  disableStdin: true,
                  rows: 30
                });
                const fitAddon = new FitAddon.FitAddon();
                const webLinksAddon = new WebLinksAddon.WebLinksAddon();
                term.loadAddon(fitAddon);
                term.loadAddon(webLinksAddon);
                term.open(document.getElementById('terminal'))
                fitAddon.fit();
                window.addEventListener("resize", e => fitAddon.fit());
                return {
                  randoGameBtn,
                  back2rando,
                  zipfiledownload,
                  back2randobtnlistenr,
                  logo,
                  term
                }
              }
              function randomizeGame() {
                const {
                  randoGameBtn,
                  back2rando,
                  zipfiledownload,
                  back2randobtnlistenr,
                  logo,
                  term
                } = initTerminal(`Randomizing Game...`);
                const obj = document.getElementById('randomizer');
                term.write(`Running Randomizer...`);
                const v = document.getElementById('randoVer').textContent;
                const id = document.getElementById('presetCustomization').value != "disabled" ? (Math.random()).toString().substring(2) : (() => {
                  const currentPresetNum = document.getElementById('preset').getAttribute("data-presetNum");
                  for (const child of document.getElementById('presets').children) {
                    if (child.getAttribute('data-presetNum') == currentPresetNum) return child.id;
                  }
                })()
                jQuery.post(
                  `/randomizer/${id}?v=z17&execVersion=${v.startsWith("v") ? v.substring(1) : v}&${$(obj).serialize()}`, 
                  d => {
                    if (d.isRandomizing) {
                      function c() {
                        jQuery.get("/randomizationStatus", l => {
                          const doneText = "Press Enter to continue...";
                          term.clear();
                          term.write(l.split(doneText).join(''));
                          function handleError(e) {
                            randoGameBtn.textContent = `Game Randomization Failed`;
                            term.write(e);
                            back2rando.addEventListener("click", back2randobtnlistenr);
                            back2rando.classList.remove("d-none");
                            back2rando.classList.add("d-flex");
                          }
                          if (!l.includes(doneText)) c();
                          else try {
                            term.write(`\r\nRetrieving Your Randomized Game...\r\n`);
                            fetch(`/genZipFromRandomizedGame?${new URLSearchParams(d.data).toString()}`, {
                              method: "POST"
                            }).then(async res => {
                              if (res.ok) {
                                const blob = await res.blob();
                                if (blob) {
                                  randoGameBtn.textContent = `Game Randomization Successful`;
                                  term.write(
                                    `Your randomized game was retrieved successfully!\r\nTo download it, click on the "Download Randomized Game" button below.`
                                  );
                                  back2rando.addEventListener("click", back2randobtnlistenr);
                                  back2rando.classList.remove("d-none");
                                  back2rando.classList.add("d-flex");
                                  zipfiledownload.href = URL.createObjectURL(blob);
                                  zipfiledownload.classList.remove('d-none');
                                  zipfiledownload.classList.add('d-flex');
                                } else handleError("Your ZIP file for the randomized version of albw could not be retrieved due to an unknown error")
                              } else handleError(`Could not get your randomized game due to the following: ${await res.text()}. Please try randomizing your game again.`)
                            }).catch(e => handleError(e.toString()))
                          } catch (e) {
                            handleError(e);
                          }
                        })
                      }
                      c();
                    }
                  }
                )
              }
              function genRanNumber(id) {
                const elem = document.getElementById(id);
                elem.value = Math.floor(Math.random() * Number(elem.max) || 7);
              }
              function appendSetting(preset) {
                let html = `<div class="input-grpup" title="Allows you to manually type in your own seed if you want to.">
                  <label class="form-label" for="seed">Seed (Optional)</label>
                  <input type="number" class="form-control" id="seed" name="seed" value="${preset.seed}">
                  <input type="hidden" name="writeNewPreset" value="true">
                  <input type="hidden" name="deletePreset" value="true">
                </div>`;
                for (const settingName in preset.settings) {
                  const info = preset.settings[settingName];
                  if (info.rangeNumOptionsTo) html += `<div class="col-12"${info.comment ? `title='${info.comment.split("'").join("")}'` : ''}>
                    <label for="${settingName}" class="form-label">${settingName.split("_").map(capWord).join(' ')}</label>
                    <div class="input-group">
                      <input type="button" class="input-group-text" onclick="genRanNumber('${settingName}')" value="Generate Random Number"/>
                      <input type="number" class="form-control" name="settings[${settingName}]" id="${settingName}" placeholder="${settingName.split(
                        "_"
                      ).map(capWord).join(' ')}" min="0" max="${info.rangeNumOptionsTo}" value="${info.defaultValue}" required>
                    </div>
                  </div>`;
                  else if (!info.useCheckmarks) {
                    const options = info.useBooleanOptions ? [true, false] : info.allOptions;
                    if (Array.isArray(options)) html += `<div class="col-md-5"${info.comment ? `title='${info.comment.split("'").join("")}'` : ''}>
                      <label for="${settingName}" class="form-label">${settingName.split("_").map(capWord).join(' ')}</label>
                      <select class="form-select" id="${settingName}" name="settings[${settingName}]" required>${
                        options.map(v => `<option value="${v}"${info.defaultValue == v ? ' selected' : ''}>${v}</option>`)
                      }</select>
                    </div>`
                  } else html += `<div class="accordion" id="${settingName}"${info.comment ? `title='${info.comment.split("'").join("")}'` : ''}>
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${settingName}collapse" aria-expanded="false" aria-controls="${settingName}collapse">
                          ${settingName.split("_").map(capWord).join(' ')}
                        </button>
                      </h2>
                      <div id="${settingName}collapse" class="accordion-collapse collapse" data-bs-parent="#${settingName}">
                        <div class="accordion-body">${(() => {
                          function c(options, name) {
                            let html = '';
                            for (const i in options) {
                              const k = i.split("'").join('');
                              const n = name.split(" ").join("")
                              if (typeof options[i] == "object") html += `<div class="accordion" id="${n}@${k.split(" ").join("")}">
                                <div class="accordion-item">
                                  <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${n}@${k.split(" ").join("")}Collapse" aria-expanded="false" aria-controls="${n}@${k.split(" ").join("")}Collapse">
                                      ${i.split("_").map(capWord).join(' ')}
                                    </button>
                                  </h2>
                                  <div id="${n}@${k.split(" ").join("")}Collapse" class="accordion-collapse collapse" data-bs-parent="#${n}@${k.split(" ").join("")}">
                                    <div class="accordion-body">${c(options[i], `${name}@${k}`)}</div>
                                  </div>
                                </div>
                              </div>`;
                              else html += `<div class="form-check">
                                <input class="form-check-input" id="${n}@${k}" name="settings[${settingName}][${k}]" type="checkbox">
                                <label for="${n}@${k}" class="form-check-label">${k.split("_").map(capWord).join(' ')}</label>
                              </div>`;
                            }
                            return html;
                          }
                          return c(info.allOptions, settingName);
                        })()}</div>
                      </div>
                    </div>
                  </div>`;
                }
                document.getElementById('randoSettings').innerHTML = html;
              }
              function string2boolean(s) { // Converts a string to a boolean
                switch (s) {
                  case "true": return true;
                  case "false": return false;
                  default: {
                    if (isNaN(Number(s))) return s;
                    return Number(s);
                  }
                }
              }
              function parseArrayJSON(json) {
                for (const key in json) {
                  if (key.includes("[") && key.includes("]")) {
                    const beg = key.split("[")[0];
                    json[beg] ||= {};
                    let k = key.split("][").join(">").split("]").join(">").split("[").join(">").split(">");
                    function c(e = 0) {
                      if (e == k.length - 1) return json[key];
                      const a = {};
                      a[k[e]] = c(e + 1);
                      return a;
                    }
                    const info = c();
                    for (const k in info[beg]) info[beg][k] = string2boolean(info[beg][k]);
                    Object.assign(json[beg], info[beg]);
                    delete json[key];
                  } else json[key] = string2boolean(json[key])
                }
                return json;
              }
              function deletePreset(fileId) {
                let hasConsent = confirm('Are you sure that you want to delete this preset?');
                function handleError(e) {
                  console.error(e);
                  displayAlert("danger", e.toString());
                  $("#myPresetsModal").modal('hide');
                  $("#myPresetsModalDialog").show();
                  $("#presetModificationPleaseWait").hide();
                  $("#presetModificationStatus").text('');
                }
                if (hasConsent) {
                  $("#myPresetsModalDialog").hide();
                  $("#presetModificationPleaseWait").show();
                  $("#presetModificationStatus").text('Deleting Preset...');
                  const socket = new WebSocket(`${grabURL4WebSocket()}/uploadFile`);
                  socket.addEventListener("message", e => {
                    switch (e.data) {
                      case "ok": {
                        socket.send(JSON.stringify({
                          onFileUploadAfter: "deletePreset",
                          fileId
                        }));
                        break;
                      } case "success": {
                        loadSettings(() => {
                          socket.close();
                          handleError('')
                          displayAlert("success", `Your preset was successfuly deleted!`)
                          delete gameRandoSourceCode.publishingPreset[`publishingPresetDiv${fileId || ''}`];
                        });
                        break;
                      } case "fail": {
                        socket.close();
                        handleError('An unknown error occured while deleting your preset from the server.');
                      }
                    }
                  })
                }
              }
              function uploadPreset(obj) {
                if (obj) {
                  displayAlert()
                  const id = obj.id || '';
                  const publishingPreset = Object.fromEntries(new URLSearchParams($(obj).serialize()));
                  gameRandoSourceCode.publishingPreset ||= {};
                  publishingPreset.private = !gameRandoSourceCode.publishingPreset[`publishingPresetDiv${id || ''}`] 
                  publishingPreset.notEditing = obj.getAttribute("data-editingpreset") != "1";
                  const elem = 'preset' + (publishingPreset.notEditing ? 'Upload' : 'Modification');
                  $('#' + elem + "Status").text('Uploading Preset...');
                  const presetFile = document.getElementById('presetFile' + id).files[0];
                  const ext = presetFile ? presetFile.name.substring(presetFile.name.lastIndexOf(".")) : ".json";
                  publishingPreset.filename = id ? (id + ext) : `settingsPreset-z17-${(Math.random()).toString().substring(2)}${ext}`;
                  document.getElementById('myPresetsModalDialog').style.display = "none"
                  obj.style.display = "none";
                  $('#' + elem + "PleaseWait").show();
                  function handleError(e) {
                    if (e) console.error(e);
                    $("#presetUploader").modal('hide');
                    $("#myPresetsModal").modal('hide');
                    if (e) displayAlert("danger", e.toString());
                    $('#' + elem + "PleaseWait").hide()
                    document.getElementById('myPresetsModalDialog').style.display = "block"
                    obj.style.display = "block";
                  }
                  if (presetFile) {
                    const fileInfo = {};
                    for (const i in presetFile) fileInfo[i] = presetFile[i];
                    const socket = new WebSocket(`${grabURL4WebSocket()}/uploadFile?${new URLSearchParams(fileInfo).toString()}`);
                    const fileChunks = [];
                    const fileName = fileInfo.name; // Variable to store the name of the original file
                    switch (fileName.substring(fileName.lastIndexOf(".") + 1)) { // supported file types
                      case "json": break; // supported
                      // goes to default for unsupported files
                      default: return handleError("You have selected an unsupported file type for your preset. Please upload a file with the supported file type.");
                    }
                    const totalChunks = 100; // Variable to store the number of chunks
                    $('#' + elem + "Status").text('Preparing Your Preset File for upload...');
                    const progress = document.getElementById(elem + "Progress");
                    progress.setAttribute("max", presetFile.size);
                    const chunkSize = Math.ceil(progress.getAttribute("max") / totalChunks);
                    progress.value = 0;
                    for (let i = 0; i < totalChunks; i++) {
                      const chunk = presetFile.slice(progress.value, progress.value + chunkSize);
                      fileChunks.push(chunk);
                      progress.value += chunkSize;
                    }
                    $('#' + elem + "Status").text('Uploading Your Preset File to the server...');
                    progress.value = 0;
                    progress.setAttribute("max", totalChunks);
                    socket.addEventListener("message", result => {
                      switch (result.data) {
                        case "ok": {
                          if (progress.value < progress.getAttribute("max")) {
                            console.log('Server response:', result.data);
                            socket.send(fileChunks[progress.value]);
                            progress.value++
                          } else {
                            console.log('All chunks uploaded successfully.');
                            console.log(`The final response from server: ${result.data}`);
                            $('#' + elem + "Status").text('Attempting to make your preset usable...');
                            progress.removeAttribute("value");
                            socket.send(JSON.stringify({
                              onFileUploadAfter: "convert2preset",
                              publishingPreset,
                              expectedPresetV: "z17"
                            }));
                          }
                          break;
                        } case "success": {
                          loadSettings(() => {
                            socket.close();
                            handleError('')
                            displayAlert("success", `Your successfuly brought in your own preset! If things were done correctly, 
                            you or the other user should be able to use your preset at any time.`)
                            obj.reset();
                            delete gameRandoSourceCode.publishingPreset[`publishingPresetDiv${id || ''}`];
                          });
                          break;
                        } case "fail": {
                          socket.close();
                          handleError('An unknown error occured while uploading your preset to the server.');
                        } case "incompatiableVersionError": {
                          socket.close();
                          handleError('Your preset does not meet the version requirements needed in order to be loaded with the v0.4 family of the albw randomizer. Please upload a preset that is compatiable with the v0.4 family of albwr.');
                        }
                      }
                    })
                  } else if (!publishingPreset.private) { 
                    const socket = new WebSocket(`${grabURL4WebSocket()}/uploadFile`);
                    socket.addEventListener("message", result => {
                      switch (result.data) {
                        case "ok": {
                          if (
                            publishingPreset.notEditing || publishingPreset.publishCurrentSettings
                          ) Object.assign(publishingPreset, parseArrayJSON(Object.fromEntries(new URLSearchParams($("#randomizer").serialize()))));
                          socket.send(JSON.stringify({
                            onFileUploadAfter: "convert2preset",
                            publishingPreset,
                            expectedPresetV: "z17"
                          }));
                          break;
                        } case "success": {
                          loadSettings(() => {
                            socket.close();
                            handleError('')
                            displayAlert("success", `Your successfuly brought in your own preset! If things were done correctly, 
                            you or the other user should be able to use your preset at any time.`)
                            obj.reset();
                            delete gameRandoSourceCode.publishingPreset[`publishingPresetDiv${id || ''}`] 
                          });
                          break;
                        } case "fail": {
                          socket.close();
                          handleError('An unknown error occured while uploading your preset to the server.');
                        } case "incompatiableVersionError": {
                          socket.close();
                          handleError('Your preset does not meet the version requirements needed in order to be loaded with the v0.4 family of the albw randomizer. Please upload a preset that is compatiable with the v0.4 family of albwr.');
                        }
                      }
                    })
                  } else handleError('You need to either upload a preset file or select the Publish Preset checkbox.');
                } else $("#presetUploader").modal("show");
              }
              async function loadSettings(callback) {
                $("#randoSettings").html('');
                $("#randoGameBtn").attr("disabled", "");
                gameRandoSourceCode.myip ||= await gameRandoSourceCode.jQueryURL('get', '/whatismyip');
                document.getElementById('presets').innerHTML = `<li class="dropdown-item d-flex justify-content-between" onclick="uploadPreset()">
                  <div>
                    <h6 class="my-0">Bring Your Own Preset</h6>
                    <small class="text-body-secondary">
                      With this feature, you may upload a preset file that will be used during game randomization!<br> 
                      You may choose to publish your preset before it gets uploaded if you want to.
                    </small>
                  </div>
                  <span class="text-warning">BETA FEATURE</span>
                </li><li class="dropdown-item d-flex justify-content-between" data-bs-toggle="modal" data-bs-target="#myPresetsModal">
                  <div>
                    <h6 class="my-0">Your Presets</h6>
                    <small class="text-body-secondary">
                      You may view the presets that you uploaded when this option is clicked. You may choose to delete or modify your preset with this option.
                    </small>
                  </div>
                  <span class="text-warning">BETA FEATURE</span>
                </li>`
                const presetSettingsloading = $("#presetSettingsLoading");
                if (presetSettingsloading.hasClass("d-none")) {
                  presetSettingsloading.removeClass("d-none");
                  presetSettingsloading.addClass("d-flex")
                }
                jQuery.getJSON(`/settings/stable/z17`, d => {
                  presets = d;
                  const myPresets = presets.filter(i => i.publisherIP == gameRandoSourceCode.myip);
                  $("#myPresets").html(`<div class="container text-center">
                    <div class="row row-cols-auto">
                      ${myPresets.map(v => `<div class="col-md-auto">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title">${v.presetName}</h5>
                            <p class="card-text">
                              NOTES:
                              <ul>${v.notes.map(v => `<li>${v}</li>`).join('\r\n') || '<li>No notes were provided</li>'}</ul>
                            </p>
                            <a data-bs-toggle="collapse" href="#${v.id}" class="btn btn-primary">Modify Preset</a>
                            <a href="javascript:deletePreset('${v.id}')" class="btn btn-danger">Delete Preset</a>
                            <form class="collapse" id="${v.id}" data-editingpreset="1" action="javascript:;">
                              <div class="card card-body">
                                <div title="If you want, you may replace your current preset settings with the updated ones that you provided yourself in a JSON format. This allows users to upload their preset file as many times as they like without messing up server storage.">
                                  <label class="form-label" for="presetFile${v.id}">Preset File (Must be a JSON file)</label>
                                  <input type="file" id="presetFile${v.id}" accept=".json" class="form-control"/>
                                </div>
                                <div title="When checked, a section will appear where you can begin typing in your preset infomation">
                                  <br>
                                  <input${!v.private ? ' checked=""' : ''} type="checkbox" onclick="setupPresetPublisher('publishingPresetDiv${v.id}', true)" class="form-check-input" id="publishPresetCheckmark${v.id}"/>
                                  <label class="form-check-label" for="publishPresetCheckmark${v.id}">Publish Preset</label>
                                </div>
                                <div id="publishingPresetDiv${v.id}"></div>
                                ${!v.private ? `<script>
                                  $("#publishingPresetDiv${v.id}").html($("#publishingPresetDiv${v.id}Content").html());
                                  gameRandoSourceCode.publishingPreset ||= {};
                                  gameRandoSourceCode.publishingPreset['publishingPresetDiv${v.id}'] = true;
                                <\/script>` : ''}
                                <div title="When checked, this will publish your current settings during preset modification. Otherwise, your current settings will not be published by default.">
                                  <br>
                                  <input type="checkbox" name="publishCurrentSettings" class="form-check-input" id="publishCurrentSettings${v.id}"/>
                                  <label class="form-check-label" for="publishCurrentSettings${v.id}">Publish Current Preset Settings</label>
                                </div>
                              </div>
                              <button onclick="uploadPreset(document.getElementById('${v.id}'))" class="btn btn-primary">Confirm Preset Modification</button>
                            </form>
                            <div id="publishingPresetDiv${v.id}Content" style="display: none;">
                              <div class="form-floating" title="A name for your preset. Make sure to title it in a way where it's easy to find.">
                                <input type="text" class="form-control" id="presetName${v.id}" placeholder="My New Preset" name="presetName" value="${v.presetName}">
                                <label for="presetName${v.id}">Preset Name</label>
                              </div>
                              <div class="form-floating" title="Any notes about your preset. As of right now, this feature only works in the v0.4 family of the albw randomizer. PRO TIP: Pressing the enter key while typing in your notes will create bulletpoints which can help for if you want to make your notes a list essentially.">
                                <textarea class="form-control" id="presetNotes${v.id}" placeholder="You should play this preset for the best experience with the albw randomizer!" name="notes" style="height: ${v.notes.join('').length}px;">${v.notes.join('\r\n')}</textarea>
                                <label for="presetNotes${v.id}">Notes (Optional)</label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>`).join('\r\n') || `<div class="container">
                        <div class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-body-secondary">
                          <div class="col-lg-6 px-0">
                            <h1 class="display-4 fst-italic">Looks like you have not created any presets yet.</h1>
                            <p class="lead my-3">There is so much benefit if you create your own preset. You may click on the "Show Benefits" link to learn more.</p>
                            <p class="lead mb-0">
                              <a href="javascript:;" data-bs-target="#presetBenefits" data-bs-toggle="collapse" class="text-body-emphasis fw-bold">
                                Show Benefits
                              </a>
                            </p>
                          </div>
                        </div>
                        <div class="row g-5 collapse bg-body-tertiary" id="presetBenefits">
                          <div class="col-md-8">
                            <h3 class="pb-4 mb-4 fst-italic border-bottom">
                              The Benefits Of Creating A Preset
                            </h3>
                            <article class="blog-post">
                              <p>
                                While that's optional, creating a preset will help users in the ALBWR community randomize their game with it if they wanted to.
                                You also won't have to worry about recreating user settings from the images manually if the publisher
                                decides to upload their preset using <a href="javascript:uploadPreset()">this tool</a>.
                              </p>
                            </article>
                          </div>
                        </div>
                      </div>`}
                    </div>
                  </div>`)
                  const preset = document.getElementById('preset');
                  if (document.getElementById('presetCustomization').value != "disabled") appendSetting(d[0]);
                  for (var i = 0; i < d.length; i++) document.getElementById('presets').insertAdjacentHTML(
                    "beforeend", `<li class="dropdown-item d-flex justify-content-between${i == 0 ? ' active' : ''}" data-presetNum="${i}" onclick="selectPreset(this)" id="${d[i].id}">
                      <div>
                        <h6 class="my-0">${d[i].presetName}</h6>
                        <small class="text-body-secondary">
                          NOTES:
                          <ul>${d[i].notes.map(v => `<li>${v}</li>`).join('') || '<li>No notes were provided.</li>'}</ul>
                        </small>
                      </div>
                      <span class="text-info">${d[i].version}</span>
                    </li>`
                  );
                  preset.innerText = `${d[0].presetName}`;
                  preset.setAttribute("data-presetNum", 0);
                  const presetSettingsloading = $("#presetSettingsLoading");
                  if (presetSettingsloading.hasClass("d-flex")) {
                    presetSettingsloading.removeClass("d-flex");
                    presetSettingsloading.addClass("d-none")
                  }
                  $("#randoGameBtn").removeAttr("disabled");
                  if (typeof callback == "function") callback();
                });
              }
              function cliRedirect(e) {
                const execV = document.getElementById('randoVer').textContent;
                let link = `/cli?sourceVersion=stable&type=randomizer&v=z17&execV=${execV.startsWith("v") ? execV.substring(1) : execV}`;
                if (e.getAttribute("data-args")) link += ` ${e.getAttribute("data-args")}`;
                window.open(link, '_blank');
              }
            </script>
            <div class="card p-1">
              <input type="button" class="btn btn-primary cliLink" value="Randomize Game With The CLI" onclick="cliRedirect(this)"/>
            </div>
            <div class="card p-1">
              <input type="button" class="btn btn-secondary cliLink" data-args="--help" value="About RandoCLI" onclick="cliRedirect(this)" title="You may click on this button to help you ensure that you are really using your selected version of the CLI that is used to randomize your game."/>
            </div>
          </div>
          <div class="col-md-7 col-lg-8">
            <button class="hideDuringRandomization justify-content-between align-items-center mb-3 btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
              <span>Setting Presets</span>
              <span class="badge bg-primary rounded-pill" id="preset"></span>
            </button>
            <ul class="dropdown-menu mb-3" id="presets"></ul>
            <div title="When this setting is disabled, you won't have to worry about customizing your preset with the GUI until you reload or leave this page. You will just instead select a preset option provided for game generation. However, if this option is set to disabled, you will be required to match your randomizer version with the preset that's selected. It's version should be shown on the top right corner of the preset option button. This is usually good for those that want to play the seed with nothing changing like it's hash and etc (the hash may still change depending on how the preset was uploaded). If you want to change some settings, leave this setting alone." class="hideDuringRandomization">
              <label for="presetCustomization" class="form-label">Preset Editor</label><br>
              <select id="presetCustomization" onchange="loadSettings()" class="form-select">
                  <option>enabled</option>
                  <option>disabled</option>
              </select>
            </div>
            <h4 class="mb-3 hideDuringRandomization">Randomizer Settings</h4>
            <form action="javascript:;" onsubmit="randomizeGame()" id="randomizer">
              <input type="hidden" name="version" value="v0.4.0"/>
              <div class="d-flex justify-content-center" id="presetSettingsLoading">
                <div class="spinner-border m-5" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <div class="row g-3 hideDuringRandomization" id="randoSettings" data-isFlex></div>
              <input type="hidden" name="sourceVersion" value="stable"/>
              <hr class="my-4 hideDuringRandomization">
              <h4 class="mb-3 hideDuringRandomization">Game Generation Options</h4>
              <div class="form-check hideDuringRandomization" title="Adds a flag/arguement to the albw randomizer executable where it is told to not patch your game at all.">
                <input type="checkbox" class="form-check-input" id="noPatch" name="noPatch">
                <label class="form-check-label" for="noPatch">Disable Game Patching</label>
              </div>
              <div class="form-check hideDuringRandomization" title="Adds a flag/arguement to the albw randomizer executable where it is told to not generate your spoiler log.">
                <input type="checkbox" class="form-check-input" id="noSpoilers" name="noSpoilers">
                <label class="form-check-label" for="noSpoilers">Disable Spoiler Log</label>
              </div>
              <hr class="my-4 hideDuringRandomization">
              <button class="btn btn-primary btn-lg" type="submit" id="randoGameBtn" disabled>Randomize Game</button>
              <center class="btn-group">
                <input type="button" class="d-none btn btn-secondary btn-lg" id="back2randobtn" value="<- Back To Randomizer"/>
                <a class="d-none btn btn-success btn-lg" id="zipfiledownload" download="albw-randomized.zip">Download Randomized Game -></a>
              </center>
            </form>
          </div>
        </div>
      </main>
      <footer class="my-5 pt-5 text-body-secondary text-center text-small">
        <p class="mb-1">&copy; 2025â<script>document.write(new Date().getFullYear())</script> - ALBWR Web</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="/">Home Page</a></li>
          <li class="list-inline-item"><a href="https://github.com/rickfay/z17-randomizer" target="_blank">ALBWR Source Code</a></li>
          <li class="list-inline-item"><a href="https://github.com/josephanimate2021/ALBWR-Web">Source Code For This Website</a></li>
          <li class="list-inline-item"><a href="https://discord.gg/dmAJh2uY7M" target="_blank">ALBWR Discord Server</a></li>
          <li class="list-inline-item"><a href="https://albwrandomizer.com/">Rickfay's ALBWR Website (Coming Soon)</a></li>
        </ul>
      </footer>
    </div>
  </body>
</html>
